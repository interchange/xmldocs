#!/usr/bin/perl

use warnings;
use strict;

my %items;
my %alphabet;
my $verbose = 0;

# HEAD
my $glossary = <<__ENDP__;
<?xml version="1.0" standalone="no"?>

<!DOCTYPE glossary PUBLIC "-//OASIS//DTD DocBook-Interchange XML V4.2//EN"
  "docbook/docbookix.dtd">

<glossary>
	<title>Interchange Documentation: Glossary</title>

__ENDP__

# LOAD ITEMS
opendir DIR, "glossary" or die "Can't open glossary/ ($!)\n";
readdir DIR; readdir DIR;

while ( my $file = readdir DIR ) {
	open IN, "< glossary/$file" or die "Can't read-open glossary/$file ($!)\n";
	$items{$file} = [ <IN> ];
	$alphabet{ lc(substr($file, 0, 1)) }++;
	print "Added $file\n" if $verbose;
	close IN or warn "Error closing glossary/$file ($!)\n";
}
closedir DIR or warn "Error closing glossary/ ($!)\n";

# ADD ITEMS TO HEAD
for my $letter ( sort keys %alphabet ) {
	next unless $alphabet{$letter}; # Next if no entries on that letter
	print "Passed on $letter\n" if $verbose;

	$glossary .= '<glossdiv><title>' . uc($letter) . '</title>' . "\n";

	my @keys = sort grep {/^$letter/i} keys %items;
	for my $key ( @keys ) {
		print "FOUND KEY $key\n" if $verbose;
		$glossary .= join "", @{ $items{$key} };
	}

	$glossary .= '</glossdiv>' . "\n";
}

$glossary .= '</glossary>';

# SAVE OUT
open OUT, "> guides/glossary.xml" or
die "Can't wropen guides/glossary.xml ($!)\n";
print OUT $glossary;
close OUT or warn "Cant close guides/glossary.xml ($!)\n";

