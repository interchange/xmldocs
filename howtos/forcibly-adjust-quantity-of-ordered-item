Forcibly Adjust Quantity of Ordered Item

Since your stock may be limited, you could want to stop users from 
ordering more items than you have.
</para><para>
There are a number of ways to do this. Here is one; the code should
be placed at the top of the basket and checkout page:
</para><para>
<programlisting><![CDATA[
[perl tables=inventory]
  my $cart = $Carts->{main};
  my $item;
  foreach $item (@$cart) {
    my $on_hand = tag_data('inventory', 'quantity', $item->{code});
    next if $on_hand >= $item->{quantity};
    $item->{quantity} = $on_hand;
    $item->{q_message} = "Order quantity adjusted to fit stock.";
  }
[/perl]
]]></programlisting>

Then you can place <code>[item-modifier q_message]</code> somewhere in the
item line to notify the customer of adjusted quantity.
</para><para>
For the code to work, you need an <database>inventory</database>
&glos-database; that has a <database class='field'>quantity</database> field
for all items.

<!-- PORT_OLD -->
